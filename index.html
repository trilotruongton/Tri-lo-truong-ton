<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tr√≠ L·ªô Tr∆∞·ªùng T·ªìn - Ebook</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="images/favicon.png">
</head>
<body>
  <header>
    <div class="brand">
      <img src="images/favicon.png" alt="Logo" class="qr">
      <h1>Tr√≠ L·ªô Tr∆∞·ªùng T·ªìn</h1>
    </div>
    <button id="cartBtn">üõí Gi·ªè h√†ng (<span id="cartCount">0</span>)</button>
  </header>

  <main>
    <h2>Danh s√°ch Ebook</h2>
    <div id="bookList" class="book-list"></div>
  </main>

  <!-- Modal Gi·ªè h√†ng -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeCart">&times;</button>
      <h3>Gi·ªè h√†ng</h3>
      <div id="cartItems"></div>
      <button id="checkoutBtn" class="btn">ƒê·∫∑t h√†ng</button>
    </div>
  </div>

  <!-- Modal Checkout -->
  <div id="checkoutModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeCheckout">&times;</button>
      <h3>Th√¥ng tin ƒë·∫∑t h√†ng</h3>
      <form id="orderForm" action="https://formsubmit.co/vang11112006@gmail.com" method="POST" onsubmit="return goThankYou(event)">
        <input type="text" name="T√™n kh√°ch h√†ng" placeholder="H·ªç v√† t√™n" required>
        <input type="email" name="Email" placeholder="Email" required>
        <input type="text" name="SƒêT" placeholder="S·ªë ƒëi·ªán tho·∫°i">
        <textarea name="Ghi ch√∫" placeholder="Ghi ch√∫ th√™m"></textarea>
        <button type="submit" class="btn">G·ª≠i ƒë∆°n</button>
      </form>
    </div>
  </div>

  <!-- N√∫t Facebook + Messenger -->
  <div class="social-buttons">
    <a href="https://www.facebook.com" target="_blank">Facebook</a>
    <a href="https://m.me" target="_blank">Messenger</a>
  </div>

  <script>
    // üìö Danh s√°ch ƒë·∫ßy ƒë·ªß 6 s√°ch
    const books = [
      { id: 1, title: "Tuy·ªát M·∫≠t Nh√¢n T√≠nh", price: 0, desc: "0ƒë, s√°ch t·∫∑ng" },
      { id: 2, title: "Nh√¢n T√≠nh ƒêen Tr·∫Øng", price: 90000, desc: "Gi√°: 90.000ƒë" },
      { id: 3, title: "T∆∞ Duy S√¢u S·∫Øc", price: 150000, desc: "Gi√°: 150.000ƒë" },
      { id: 4, title: "Thi√™n C∆° 38 C·ª•c", price: 120000, desc: "Gi√°: 120.000ƒë" },
      { id: 5, title: "Ki·∫øm ƒê·∫°i", price: 90000, desc: "Gi√°: 90.000ƒë" },
      { id: 6, title: "Logic Ng∆∞·ªùi Ngh√®o", price: 100000, desc: "Gi√°: 100.000ƒë" }
    ];

    const bookList = document.getElementById("bookList");
    const cartBtn = document.getElementById("cartBtn");
    const cartModal = document.getElementById("cartModal");
    const checkoutModal = document.getElementById("checkoutModal");
    const closeCart = document.getElementById("closeCart");
    const closeCheckout = document.getElementById("closeCheckout");
    const cartItems = document.getElementById("cartItems");
    const checkoutBtn = document.getElementById("checkoutBtn");
    const cartCount = document.getElementById("cartCount");

    const CART_KEY = "ebook_cart";

    function formatVND(x) {
      if (x === 0) return "0ƒë, s√°ch t·∫∑ng";
      return x.toLocaleString("vi-VN") + "‚Ç´";
    }

    function loadCart() {
      return JSON.parse(localStorage.getItem(CART_KEY) || "[]");
    }

    function saveCart(cart) {
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
    }

    function updateCartCount() {
      const cart = loadCart();
      let total = 0;
      cart.forEach(item => total += item.qty);
      cartCount.textContent = total;
    }

    function renderBooks() {
      books.forEach(b => {
        const div = document.createElement("div");
        div.className = "book";
        div.innerHTML = `
          <h4>${b.title}</h4>
          <p>${b.desc}</p>
          <button onclick="addToCart(${b.id})">Th√™m v√†o gi·ªè</button>
        `;
        bookList.appendChild(div);
      });
    }

    function addToCart(id) {
      let cart = loadCart();
      const item = cart.find(x => x.id === id);
      if (item) {
        item.qty++;
      } else {
        cart.push({ id, qty: 1 });
      }
      saveCart(cart);
      updateCartCount();
    }

    function renderCart() {
      const cart = loadCart();
      if (cart.length === 0) {
        cartItems.innerHTML = "<p>Gi·ªè h√†ng tr·ªëng</p>";
        return;
      }
      cartItems.innerHTML = cart.map(ci => {
        const book = books.find(b => b.id === ci.id);
        return `<p>${book.title} x ${ci.qty} = ${formatVND(book.price * ci.qty)}</p>`;
      }).join("");
    }

    cartBtn.onclick = () => { renderCart(); cartModal.style.display = "block"; };
    closeCart.onclick = () => cartModal.style.display = "none";
    closeCheckout.onclick = () => checkoutModal.style.display = "none";
    checkoutBtn.onclick = () => { cartModal.style.display = "none"; checkoutModal.style.display = "block"; };

    function goThankYou(e){
      e.preventDefault();
      const cart = loadCart();
      let total = 0;
      cart.forEach(ci=>{
        const b = books.find(x=>x.id===ci.id);
        if(b) total += b.price * ci.qty;
      });

      // g·ª≠i form v·ªÅ email
      e.target.target = "_blank";
      e.target.submit();

      // chuy·ªÉn sang trang thankyou.html k√®m s·ªë ti·ªÅn
      window.location.href = "thankyou.html?amount=" + total;
      localStorage.removeItem(CART_KEY);
      updateCartCount();
      return false;
    }

    renderBooks();
    updateCartCount();
  </script>
</body>
</html>
