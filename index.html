<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrÃ­ Lá»™ TrÆ°á»ng Tá»“n - Ebook</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="images/favicon.png">
  <style>
    .qr-box { text-align:center; margin-top:20px; }
    .qr-box img { width:250px; height:250px; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img src="images/favicon.png" alt="Logo" class="qr">
      <h1>TrÃ­ Lá»™ TrÆ°á»ng Tá»“n</h1>
    </div>
    <button id="cartBtn">ğŸ›’ Giá» hÃ ng (<span id="cartCount">0</span>)</button>
  </header>

  <main>
    <h2>Danh sÃ¡ch Ebook</h2>
    <div id="bookList" class="book-list">

      <!-- 1. Tuyá»‡t Máº­t NhÃ¢n TÃ­nh -->
      <div class="book">
        <img src="images/tuyet-mat-nhan-tinh.jpg" alt="Tuyá»‡t Máº­t NhÃ¢n TÃ­nh">
        <h4>Tuyá»‡t Máº­t NhÃ¢n TÃ­nh</h4>
        <p><del>50.000Ä‘</del> â <strong>0Ä‘, sÃ¡ch táº·ng</strong></p>
        <a href="previews/tuyet-mat-nhan-tinh-doc-thu.pdf" target="_blank">ğŸ“– Äá»c thá»­</a><br>
        <button onclick="addToCart(1)">ThÃªm vÃ o giá»</button>
      </div>

      <!-- 2. NhÃ¢n TÃ­nh Äen Tráº¯ng -->
      <div class="book">
        <img src="images/nhan-tinh-den-trang.jpg" alt="NhÃ¢n TÃ­nh Äen Tráº¯ng">
        <h4>NhÃ¢n TÃ­nh Äen Tráº¯ng</h4>
        <p><del>120.000Ä‘</del> â <strong>90.000Ä‘</strong></p>
        <a href="previews/nhan-tinh-den-trang-doc-thu.pdf" target="_blank">ğŸ“– Äá»c thá»­</a><br>
        <button onclick="addToCart(2)">ThÃªm vÃ o giá»</button>
      </div>

      <!-- 3. TÆ° Duy SÃ¢u Sáº¯c -->
      <div class="book">
        <img src="images/tu-duy-sau-sac.jpg" alt="TÆ° Duy SÃ¢u Sáº¯c">
        <h4>TÆ° Duy SÃ¢u Sáº¯c</h4>
        <p><del>200.000Ä‘</del> â <strong>150.000Ä‘</strong></p>
        <a href="previews/tu-duy-sau-sac-doc-thu.pdf" target="_blank">ğŸ“– Äá»c thá»­</a><br>
        <button onclick="addToCart(3)">ThÃªm vÃ o giá»</button>
      </div>

      <!-- 4. ThiÃªn CÆ¡ 38 Cá»¥c -->
      <div class="book">
        <img src="images/thien-co-38-cuc.jpg" alt="ThiÃªn CÆ¡ 38 Cá»¥c">
        <h4>ThiÃªn CÆ¡ 38 Cá»¥c</h4>
        <p><del>170.000Ä‘</del> â <strong>120.000Ä‘</strong></p>
        <a href="previews/thien-co-38-cuc-doc-thu.pdf" target="_blank">ğŸ“– Äá»c thá»­</a><br>
        <button onclick="addToCart(4)">ThÃªm vÃ o giá»</button>
      </div>

      <!-- 5. Kiáº¿m Äáº¡i -->
      <div class="book">
        <img src="images/kiem-dai.jpg" alt="Kiáº¿m Äáº¡i">
        <h4>Kiáº¿m Äáº¡i</h4>
        <p><del>120.000Ä‘</del> â <strong>90.000Ä‘</strong></p>
        <a href="#" target="_blank">ğŸ“– Äá»c thá»­</a><br>
        <button onclick="addToCart(5)">ThÃªm vÃ o giá»</button>
      </div>

      <!-- 6. Logic NgÆ°á»i NghÃ¨o -->
      <div class="book">
        <img src="images/logic-nguoi-ngheo.jpg" alt="Logic NgÆ°á»i NghÃ¨o">
        <h4>Logic NgÆ°á»i NghÃ¨o</h4>
        <p><del>170.000Ä‘</del> â <strong>100.000Ä‘</strong></p>
        <a href="previews/logic-nguoi-ngheo-doc-thu.pdf" target="_blank">ğŸ“– Äá»c thá»­</a><br>
        <button onclick="addToCart(6)">ThÃªm vÃ o giá»</button>
      </div>

    </div>
  </main>

  <!-- Modal Giá» hÃ ng -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeCart">&times;</button>
      <h3>Giá» hÃ ng</h3>
      <div id="cartItems"></div>
      <button id="checkoutBtn" class="btn">Äáº·t hÃ ng</button>
    </div>
  </div>

  <!-- Modal Checkout -->
  <div id="checkoutModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeCheckout">&times;</button>
      <h3>ThÃ´ng tin Ä‘áº·t hÃ ng</h3>
      <form id="orderForm" onsubmit="return showQR(event)">
        <input type="text" name="TÃªn khÃ¡ch hÃ ng" placeholder="Há» vÃ  tÃªn" required>
        <input type="email" name="Email" placeholder="Email" required>
        <input type="text" name="SÄT" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i">
        <textarea name="Ghi chÃº" placeholder="Ghi chÃº thÃªm"></textarea>
        <button type="submit" class="btn">XÃ¡c nháº­n & Thanh toÃ¡n</button>
      </form>
      <div id="qrBox" class="qr-box" style="display:none;">
        <h4>QuÃ©t mÃ£ Ä‘á»ƒ thanh toÃ¡n</h4>
        <img id="qrImage" src="" alt="QR Code">
      </div>
    </div>
  </div>

  <script>
    // ğŸ“š GiÃ¡ Ä‘á»ƒ tÃ­nh toÃ¡n
    const books = [
      { id: 1, title: "Tuyá»‡t Máº­t NhÃ¢n TÃ­nh", price: 0 },
      { id: 2, title: "NhÃ¢n TÃ­nh Äen Tráº¯ng", price: 90000 },
      { id: 3, title: "TÆ° Duy SÃ¢u Sáº¯c", price: 150000 },
      { id: 4, title: "ThiÃªn CÆ¡ 38 Cá»¥c", price: 120000 },
      { id: 5, title: "Kiáº¿m Äáº¡i", price: 90000 },
      { id: 6, title: "Logic NgÆ°á»i NghÃ¨o", price: 100000 }
    ];

    const cartBtn = document.getElementById("cartBtn");
    const cartModal = document.getElementById("cartModal");
    const checkoutModal = document.getElementById("checkoutModal");
    const closeCart = document.getElementById("closeCart");
    const closeCheckout = document.getElementById("closeCheckout");
    const cartItems = document.getElementById("cartItems");
    const checkoutBtn = document.getElementById("checkoutBtn");
    const cartCount = document.getElementById("cartCount");
    const qrBox = document.getElementById("qrBox");
    const qrImage = document.getElementById("qrImage");

    const CART_KEY = "ebook_cart";

    function formatVND(x) {
      if (x === 0) return "0Ä‘, sÃ¡ch táº·ng";
      return x.toLocaleString("vi-VN") + "â‚«";
    }

    function loadCart() {
      return JSON.parse(localStorage.getItem(CART_KEY) || "[]");
    }

    function saveCart(cart) {
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
    }

    function updateCartCount() {
      const cart = loadCart();
      let total = 0;
      cart.forEach(item => total += item.qty);
      cartCount.textContent = total;
    }

    function addToCart(id) {
      let cart = loadCart();
      const item = cart.find(x => x.id === id);
      if (item) {
        item.qty++;
      } else {
        cart.push({ id, qty: 1 });
      }
      saveCart(cart);
      updateCartCount();
    }

    function renderCart() {
      const cart = loadCart();
      if (cart.length === 0) {
        cartItems.innerHTML = "<p>Giá» hÃ ng trá»‘ng</p>";
        return;
      }
      cartItems.innerHTML = cart.map(ci => {
        const book = books.find(b => b.id === ci.id);
        return `<p>${book.title} x ${ci.qty} = ${formatVND(book.price * ci.qty)}</p>`;
      }).join("");
    }

    cartBtn.onclick = () => { renderCart(); cartModal.style.display = "block"; };
    closeCart.onclick = () => cartModal.style.display = "none";
    closeCheckout.onclick = () => checkoutModal.style.display = "none";
    checkoutBtn.onclick = () => { cartModal.style.display = "none"; checkoutModal.style.display = "block"; };

    function showQR(e){
      e.preventDefault();
      const cart = loadCart();
      let total = 0;
      cart.forEach(ci=>{
        const b = books.find(x=>x.id===ci.id);
        if(b) total += b.price * ci.qty;
      });

      // Sinh QR Ä‘á»™ng (VietQR VCB)
      const accountNo = "1054523832";
      const accountName = "VANG A SONG";
      const bankCode = "VCB";
      const info = encodeURIComponent("Thanh toan Ebook");
      const qrUrl = `https://img.vietqr.io/image/${bankCode}-${accountNo}-compact2.jpg?amount=${total}&addInfo=${info}&accountName=${encodeURIComponent(accountName)}`;

      qrImage.src = qrUrl;
      qrBox.style.display = "block";

      localStorage.removeItem(CART_KEY);
      updateCartCount();
      return false;
    }

    updateCartCount();
  </script>
</body>
</html>
