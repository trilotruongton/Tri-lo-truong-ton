<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ƒê·∫°o Ng·ªô Th·ªè</title>
  <link rel="icon" type="image/png" href="images/favicon.png">
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
    header { background: #333; color: white; padding: 20px; text-align: center; }
    h1 { margin: 0; font-size: 28px; }
    .book-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding: 20px; }
    .book { border: 2px solid #ccc; padding: 20px; border-radius: 10px; text-align: center; background: #fff; }
    .book img { width: 100%; max-height: 320px; object-fit: cover; border-radius: 8px; }
    .book h4 { margin: 15px 0 10px; font-size: 20px; }
    .book p { font-size: 18px; margin: 8px 0; }
    .book a, .book button { display: block; width: 100%; padding: 14px 0; font-size: 16px; margin-top: 10px; border-radius: 6px; text-align: center; font-weight: bold; }
    .book a { background: #2980b9; color: #fff; text-decoration: none; }
    .book a:hover { background: #1f6391; }
    .book button { background: #e67e22; color: #fff; border: none; cursor: pointer; }
    .book button:hover { background: #ca6515; }
    #cartModal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); }
    .modal-content { background: #fff; margin: 5% auto; padding: 25px; border-radius: 10px; width: 90%; max-width: 600px; font-size: 18px; }
    .modal-close { float: right; font-size: 20px; cursor: pointer; background: none; border: none; }
    #qrBox { text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <header>
    <h1>üêá ƒê·∫°o Ng·ªô Th·ªè</h1>
    <button onclick="openCart()">üõí Gi·ªè h√†ng (<span id="cartCount">0</span>)</button>
  </header>

  <div class="book-list" id="bookList"></div>

  <!-- Gi·ªè h√†ng -->
  <div id="cartModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeCart()">‚úñ</button>
      <h2>Gi·ªè h√†ng c·ªßa b·∫°n</h2>
      <div id="cartItems"></div>
      <p><strong>T·ªïng c·ªông:</strong> <span id="cartTotal">0</span>‚Ç´</p>

      <form id="checkoutForm" onsubmit="return showQR(event)">
        <h3>Th√¥ng tin ng∆∞·ªùi nh·∫≠n</h3>
        <input type="text" id="name" placeholder="H·ªç v√† t√™n" required style="width:100%;padding:8px;margin:5px 0;">
        <input type="email" id="email" placeholder="Email nh·∫≠n Ebook" required style="width:100%;padding:8px;margin:5px 0;">
        <input type="tel" id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i (n·∫øu c√≥)" style="width:100%;padding:8px;margin:5px 0;">
        <button type="submit" style="width:100%;padding:10px;background:#27ae60;color:white;border:none;border-radius:6px;font-weight:bold;font-size:16px;">X√°c nh·∫≠n & Thanh to√°n</button>
      </form>

      <!-- QR ƒë·ªông -->
      <div id="qrBox" class="qr-box" style="display:none;">
        <h4>Qu√©t m√£ QR ƒë·ªÉ thanh to√°n</h4>
        <img id="qrImage" src="" alt="QR Code" style="max-width:300px;margin:10px auto;display:block;">
        <p id="totalText" style="font-weight:bold;font-size:18px;margin:10px 0;"></p>
        <p style="color:#555;font-size:15px;">
          Qu√©t m√£ QR ƒë·ªÉ thanh to√°n, b·∫°n thanh to√°n xong admin s·∫Ω g·ª≠i file Ebook qua Email ho·∫∑c Messenger nh√© ‚ù§Ô∏è
        </p>
      </div>
    </div>
  </div>

  <script>
    const CART_KEY = "cartEbook";
    const books = [
      {id:1,name:"Tuy·ªát m·∫≠t nh√¢n t√≠nh",price:0,img:"images/tuyet-mat-nhan-tinh.jpg"},
      {id:2,name:"Thi√™n c∆° 38 c·ª•c",price:120000,img:"images/thien-co-38-cuc.jpg"},
      {id:3,name:"Logic ng∆∞·ªùi ngh√®o",price:100000,img:"images/logic-nguoi-ngheo.jpg"},
      {id:4,name:"T∆∞ t∆∞·ªüng L√Ω Th·∫•t D·∫°",price:150000,img:"images/ly-that-da.jpg"},
      {id:5,name:"T√¢m th·ª©c v√† th·∫ø gi·ªõi 108 c·ª•c",price:170000,img:"images/108-cuc.jpg"},
      {id:6,name:"Tr√≠ l·ªô tr∆∞·ªùng t·ªìn",price:180000,img:"images/tri-lo-truong-ton.jpg"}
    ];

    function loadCart(){ return JSON.parse(localStorage.getItem(CART_KEY)||"[]"); }
    function saveCart(c){ localStorage.setItem(CART_KEY,JSON.stringify(c)); }
    function updateCartCount(){
      const c=loadCart();
      document.getElementById("cartCount").innerText=c.reduce((t,i)=>t+i.qty,0);
    }

    function addToCart(id){
      const c=loadCart();
      const i=c.find(x=>x.id===id);
      if(i){ i.qty++; } else { c.push({id,qty:1}); }
      saveCart(c);
      updateCartCount();
      alert("ƒê√£ th√™m v√†o gi·ªè h√†ng!");
    }

    function openCart(){
      const modal=document.getElementById("cartModal");
      const list=document.getElementById("cartItems");
      const cart=loadCart();
      let html="";
      let total=0;
      cart.forEach(ci=>{
        const b=books.find(x=>x.id===ci.id);
        if(b){
          const cost=b.price*ci.qty;
          total+=cost;
          html+=`<p>${b.name} x ${ci.qty} = ${cost.toLocaleString("vi-VN")}‚Ç´</p>`;
        }
      });
      list.innerHTML=html||"<p>Gi·ªè h√†ng tr·ªëng</p>";
      document.getElementById("cartTotal").innerText=total.toLocaleString("vi-VN");
      modal.style.display="block";
    }

    function closeCart(){ document.getElementById("cartModal").style.display="none"; }

    // ‚úÖ QR ƒë·ªông hi·ªÉn th·ªã t·ªïng ti·ªÅn + h∆∞·ªõng d·∫´n
    function showQR(e){
      e.preventDefault();
      const cart = loadCart();
      let total = 0;
      cart.forEach(ci=>{
        const b = books.find(x=>x.id===ci.id);
        if(b) total += b.price * ci.qty;
      });

      const accountNo = "1054523832";
      const accountName = "VANG A SONG";
      const bankCode = "vietcombank";
      const info = encodeURIComponent("Thanh toan Ebook Dao Ngo Tho");
      const qrUrl = `https://img.vietqr.io/image/${bankCode}-${accountNo}-compact2.png?amount=${total}&addInfo=${info}&accountName=${encodeURIComponent(accountName)}`;

      document.getElementById("qrImage").src = qrUrl;
      document.getElementById("qrBox").style.display = "block";
      document.getElementById("checkoutForm").style.display = "none"; // üü¢ ·∫®n form khi nh·∫•n thanh to√°n
      document.getElementById("totalText").innerText = "T·ªïng thanh to√°n: " + total.toLocaleString("vi-VN") + "‚Ç´";

      setTimeout(() => {
        localStorage.removeItem(CART_KEY);
        updateCartCount();
      }, 3000);

      return false;
    }

    // render danh s√°ch s√°ch
    const listDiv=document.getElementById("bookList");
    books.forEach(b=>{
      listDiv.innerHTML+=`
        <div class="book">
          <img src="${b.img}" alt="${b.name}">
          <h4>${b.name}</h4>
          <p>${b.price===0?'<strong>0ƒë (S√°ch t·∫∑ng)</strong>':b.price.toLocaleString("vi-VN")+'‚Ç´'}</p>
          <a href="#" target="_blank">üìñ ƒê·ªçc th·ª≠</a>
          <button onclick="addToCart(${b.id})">Th√™m v√†o gi·ªè</button>
        </div>`;
    });
    updateCartCount();
  </script>
</body>
</html>
