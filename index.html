<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tr√≠ L·ªô Tr∆∞·ªùng T·ªìn ‚Äî C·ª≠a h√†ng Ebook</title>
<link rel="stylesheet" href="styles.css">
<style>
/* Fix ·∫£nh gi·ªè h√†ng nh·ªè g·ªçn */
#cartItems img {
  width: 50px !important;
  height: 65px !important;
  object-fit: cover !important;
  border-radius: 4px;
  flex-shrink: 0;
  display: block;
}
.cart-item {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
}
.cart-item-details {
  flex: 1;
}
.cart-item-details strong {
  display: block;
  margin-bottom: 4px;
}
.cart-item-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
/* N√∫t n·ªïi Facebook + Messenger */
.floating-buttons {
  position: fixed;
  right: 15px;
  bottom: 15px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  z-index: 9999;
}
.floating-buttons a {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  font-size: 26px;
  color: white;
}
.fb-btn { background: #1877f2; }
.msg-btn { background: #00b2ff; }

/* B·ªë c·ª•c s√°ch */
.book-item {
  border: 1px solid #ddd;
  padding: 12px;
  margin: 12px;
  text-align: center;
  border-radius: 6px;
}
.book-item img {
  width: 100%;
  max-width: 220px;
  height: auto;
  margin: 0 auto 10px;
  display: block;
}
.book-item h4 { margin: 8px 0; font-size: 18px; }
.book-item p { margin: 6px 0; }

/* N√∫t chung */
.btn {
  display: inline-block;
  margin: 5px 3px;
  padding: 6px 12px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  text-decoration: none;
}
.btn.primary {
  background: #ff6600;
  color: #fff;
  border: none;
}
.btn.secondary {
  background: #f1f1f1;
  color: #333;
  border: 1px solid #ccc;
}
</style>
</head>
<body>
<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <img src="images/qr-code.png" alt="QR Code" class="qr">
      <h1>Tr√≠ L·ªô Tr∆∞·ªùng T·ªìn</h1>
    </div>
    <nav class="main-nav">
      <a href="index.html">Trang ch·ªß</a>
      <a href="mailto:vang11112006@gmail.com" target="_blank" rel="noopener">Li√™n h·ªá</a>
      <button id="cartBtn" class="btn primary">Gi·ªè (<span id="cart-count">0</span>)</button>
    </nav>
  </div>
</header>

<main class="container">
  <section class="books-grid" id="booksGrid"></section>
</main>

<!-- Modal gi·ªè h√†ng -->
<div id="cartModal" class="modal">
  <div class="modal-content">
    <button class="modal-close" id="closeCart">&times;</button>
    <h3>Gi·ªè h√†ng</h3>
    <div id="cartItems"></div>
    <div class="cart-summary">
      <div>T·ªïng: <strong id="cartTotal">0‚Ç´</strong></div>
      <button id="checkoutBtn" class="btn primary">ƒê·∫∑t mua</button>
    </div>
  </div>
</div>

<!-- Modal ƒë·∫∑t h√†ng -->
<div id="checkoutModal" class="modal">
  <div class="modal-content">
    <button class="modal-close" id="closeCheckout">&times;</button>
    <h3>Form ƒë·∫∑t h√†ng</h3>
    <form id="orderForm" action="https://formsubmit.co/vang11112006@gmail.com" method="POST">
      <label for="name">H·ªç v√† t√™n:</label><br>
      <input type="text" id="name" name="name" required><br><br>
      <label for="email">Email:</label><br>
      <input type="email" id="email" name="email" required><br><br>
      <label for="phone">S·ªë ƒëi·ªán tho·∫°i:</label><br>
      <input type="tel" id="phone" name="phone" required><br><br>
      <input type="hidden" name="order_details" id="order_details">
      <input type="hidden" name="_next" value="https://trilotruongton.github.io/Tri-lo-truong-ton/thank-you.html">
      <input type="hidden" name="_captcha" value="true">
      <button type="submit" class="btn primary">G·ª≠i ƒë∆°n</button>
      <button type="button" id="cancelOrder" class="btn secondary">Hu·ª∑</button>
    </form>
  </div>
</div>

<!-- N√∫t Facebook + Messenger -->
<div class="floating-buttons">
  <a href="https://www.facebook.com/share/1GUZZyoPeB/?mibextid=wwXIfr" target="_blank" class="fb-btn">f</a>
  <a href="https://m.me/100037979446635" target="_blank" class="msg-btn">üí¨</a>
</div>

<footer class="site-footer">
  <div class="container">
    <p>¬© 2025 Tr√≠ L·ªô Tr∆∞·ªùng T·ªìn</p>
  </div>
</footer>

<script>
const books = [
  { id: "b1", title: "Tuy·ªát M·∫≠t Nh√¢n T√≠nh", price: 0, priceOrig: 399000, img: "images/tuyet-mat-nhan-tinh.jpg", preview: "previews/tuyet-mat-nhan-tinh-doc-thu.pdf" },
  { id: "b2", title: "Nh√¢n T√≠nh ƒêen Tr·∫Øng", price: 90000, priceOrig: 350000, img: "images/nhan-tinh-den-trang.jpg", preview: "previews/nhan-tinh-den-trang-doc-thu.pdf" },
  { id: "b3", title: "T∆∞ Duy S√¢u S·∫Øc", price: 150000, priceOrig: 560000, img: "images/tu-duy-sau-sac.jpg", preview: "previews/tu-duy-sau-sac-doc-thu.pdf" },
  { id: "b4", title: "Thi√™n C∆° 38 C·ª•c", price: 170000, priceOrig: 560000, img: "images/thien-co-38-cuc.jpg", preview: "previews/thien-co-38-cuc-doc-thu.pdf" },
  { id: "b5", title: "Ki·∫øm ƒê·∫°i", price: 90000, priceOrig: 250000, img: "images/kiem-dai.jpg" },
  { id: "b7", title: "Logic Ng∆∞·ªùi Ngh√®o", price: 170000, priceOrig: 560000, img: "images/logic-nguoi-ngheo.jpg", preview: "previews/logic-nguoi-ngheo-doc-thu.pdf" }
];

function formatVND(n) { return n===0 ? "Mi·ªÖn ph√≠" : n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")+"‚Ç´"; }

const grid = document.getElementById('booksGrid');
books.forEach(b=>{
  const div = document.createElement('div');
  div.className = 'book-item';
  div.innerHTML = `
    <img src="${b.img}" alt="${b.title}">
    <h4>${b.title}</h4>
    <p><del>${formatVND(b.priceOrig)}</del> <strong>${formatVND(b.price)}</strong></p>
    <button class="btn primary add-to-cart" data-id="${b.id}">Th√™m v√†o gi·ªè</button>
    ${b.preview ? `<a href="${b.preview}" target="_blank" class="btn secondary">ƒê·ªçc th·ª≠</a>` : ""}
  `;
  grid.appendChild(div);
});

// ==== Gi·ªè h√†ng ====
const CART_KEY = "cart_data";
function loadCart() { return JSON.parse(localStorage.getItem(CART_KEY) || "[]"); }
function saveCart(cart) { localStorage.setItem(CART_KEY, JSON.stringify(cart)); updateCartCount(); }
function updateCartCount() { const c = loadCart(); document.getElementById("cart-count").textContent = c.reduce((s,i)=>s+i.qty,0); }
function addToCart(id) {
  const c = loadCart();
  const it = c.find(x=>x.id===id);
  if(it) it.qty++;
  else c.push({id, qty:1});
  saveCart(c);
}

document.addEventListener("click", e=>{
  if(e.target.classList.contains("add-to-cart")) addToCart(e.target.dataset.id);
  if(e.target.classList.contains("inc")) changeQty(e.target.dataset.id, 1);
  if(e.target.classList.contains("dec")) changeQty(e.target.dataset.id, -1);
  if(e.target.classList.contains("remove")) removeItem(e.target.dataset.id);
});

function renderCartItems(){
  const c = loadCart();
  const cont = document.getElementById("cartItems");
  if(!c.length){
    cont.innerHTML = "<p>Gi·ªè h√†ng tr·ªëng</p>";
    document.getElementById("cartTotal").textContent="0‚Ç´";
    return;
  }
  let html = "", total = 0;
  c.forEach(ci=>{
    const b = books.find(x=>x.id===ci.id);
    if(!b) return;
    const p = b.price;
    total += p * ci.qty;
    html += `
      <div class="cart-item">
        <img src="${b.img}" alt="${b.title}">
        <div class="cart-item-details">
          <strong>${b.title}</strong>
          <div class="cart-item-actions">
            <button class="dec" data-id="${ci.id}">-</button>
            <span>SL: ${ci.qty}</span>
            <button class="inc" data-id="${ci.id}">+</button>
            <span>${formatVND(p)}</span>
            <button class="remove" data-id="${ci.id}">X√≥a</button>
          </div>
        </div>
      </div>
    `;
  });
  cont.innerHTML = html;
  document.getElementById("cartTotal").textContent = formatVND(total);
}

function changeQty(id, d){
  const c = loadCart(); const it = c.find(x=>x.id===id);
  if(it){ it.qty += d; if(it.qty<1) it.qty=1; saveCart(c); renderCartItems(); }
}
function removeItem(id){
  let c = loadCart(); c = c.filter(x=>x.id!==id); saveCart(c); renderCartItems();
}

document.getElementById("cartBtn").onclick = ()=>{ renderCartItems(); document.getElementById("cartModal").style.display="block"; };
document.getElementById("closeCart").onclick = ()=> document.getElementById("cartModal").style.display="none";
document.getElementById("closeCheckout").onclick = ()=> document.getElementById("checkoutModal").style.display="none";
document.getElementById("cancelOrder").onclick = ()=> document.getElementById("checkoutModal").style.display="none";

document.getElementById("checkoutBtn").onclick = ()=>{
  const c = loadCart(); 
  if(!c.length){ alert("Gi·ªè h√†ng tr·ªëng"); return; }
  let lines = [], total = 0;
  c.forEach(ci=>{
    const b = books.find(x=>x.id===ci.id);
    if(!b) return;
    const p = b.price || 0;
    lines.push(`${b.title} x${ci.qty} ‚Äî ${p===0 ? 'Mi·ªÖn ph√≠' : formatVND(p)}`);
    total += p * ci.qty;
  });
  lines.push("T·ªïng: " + formatVND(total));
  document.getElementById("order_details").value = lines.join("\n");
  document.getElementById("cartModal").style.display="none";
  document.getElementById("checkoutModal").style.display="block";
};

document.getElementById("orderForm").onsubmit = ()=>{
  localStorage.removeItem(CART_KEY);
  setTimeout(()=>updateCartCount(), 500);
};

updateCartCount();
</script>
</body>
</html>
