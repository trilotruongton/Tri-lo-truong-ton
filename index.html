<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ƒê·∫°o Ng·ªô Th·ªè - Ebook</title>
  <link rel="icon" type="image/png" href="images/favicon.png">

  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <script>
    emailjs.init("Songking0006"); // PUBLIC KEY
  </script>

  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
    header { background: #333; color: white; padding: 20px; text-align: center; position: relative; }
    header h1 { margin: 0; }
    header button {
      position: absolute; right: 20px; top: 20px;
      padding: 10px 18px; background: #27ae60; color:white;
      border:none; border-radius:6px; cursor:pointer;
    }
    .book-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding: 20px; }
    .book { border: 2px solid #ccc; padding: 20px; border-radius: 10px; background:white; text-align:center; }
    .book img { width:100%; height:300px; object-fit:cover; border-radius:8px; }
    .book a, .book button {
      display:block; width:100%; padding:12px 0; margin-top:10px;
      font-size:16px; border-radius:6px; font-weight:bold; text-align:center;
    }
    .book a { background:#2980b9; color:white; text-decoration:none; }
    .book button { background:#e67e22; color:white; border:none; cursor:pointer; }

    #cartModal, #previewModal {
      display:none; position:fixed; z-index:1000;
      top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.6);
    }
    .modal-content {
      background:white; margin:5% auto; padding:25px;
      width:90%; max-width:600px; border-radius:10px;
    }
    .modal-close { float:right; border:none; background:none; font-size:20px; cursor:pointer; }
    #previewModal .preview-content {
      position:relative; width:80%; height:80%; margin:5% auto;
      background:white; border-radius:10px; overflow:hidden;
    }
    iframe { width:100%; height:100%; border:none; }
    .close-preview {
      position:absolute; top:10px; right:10px; font-size:24px;
      background:none; border:none; cursor:pointer; font-weight:bold;
    }
  </style>
</head>

<body>

<header>
  <h1>üêá ƒê·∫°o Ng·ªô Th·ªè</h1>
  <button onclick="openCart()">üõí Gi·ªè h√†ng (<span id="cartCount">0</span>)</button>
</header>

<div class="book-list" id="bookList"></div>

<!-- Modal gi·ªè h√†ng -->
<div id="cartModal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeCart()">‚úñ</button>
    <h2>Gi·ªè h√†ng</h2>

    <div id="cartItems"></div>
    <p><strong>T·ªïng c·ªông:</strong> <span id="cartTotal">0</span>‚Ç´</p>

    <form id="checkoutForm" onsubmit="return checkout(event)">
      <h3>Th√¥ng tin ng∆∞·ªùi nh·∫≠n</h3>
      <input id="name" required placeholder="H·ªç v√† t√™n" style="width:100%;padding:8px;margin:5px 0;">
      <input id="email" type="email" required placeholder="Email nh·∫≠n Ebook" style="width:100%;padding:8px;margin:5px 0;">
      <input id="phone" type="tel" placeholder="S·ªë ƒëi·ªán tho·∫°i (kh√¥ng b·∫Øt bu·ªôc)" style="width:100%;padding:8px;margin:5px 0;">
      <button type="submit" style="width:100%;padding:10px;background:#27ae60;color:white;border:none;border-radius:6px;font-size:16px;font-weight:bold;">
        X√°c nh·∫≠n & Thanh to√°n
      </button>
    </form>

    <div id="qrBox" style="display:none;text-align:center;margin-top:20px;">
      <h4>Qu√©t QR ƒë·ªÉ thanh to√°n</h4>
      <img id="qrImage" style="max-width:300px;">
      <p id="totalText" style="font-weight:bold;"></p>
    </div>
  </div>
</div>

<!-- Modal PDF -->
<div id="previewModal">
  <div class="preview-content">
    <button class="close-preview" onclick="closePreview()">‚úñ</button>
    <iframe id="previewFrame"></iframe>
  </div>
</div>


<script>
const CART_KEY = "cartEbook";

const books = [
  {id:1,name:"Tuy·ªát M·∫≠t Nh√¢n T√≠nh",price:0,img:"images/tuyet-mat-nhan-tinh.jpg",pdf:"pdf/tuyet-mat-nhan-tinh.pdf"},
  {id:2,name:"Nh√¢n T√≠nh ƒêen Tr·∫Øng",price:90000,img:"images/nhan-tinh-den-trang.jpg",pdf:"pdf/nhan-tinh-den-trang.pdf"},
  {id:3,name:"T∆∞ Duy S√¢u S·∫Øc",price:150000,img:"images/tu-duy-sau-sac.jpg",pdf:"pdf/tu-duy-sau-sac.pdf"},
  {id:4,name:"Thi√™n C∆° 38 C·ª•c",price:120000,img:"images/thien-co-38-cuc.jpg",pdf:"pdf/thien-co-38-cuc.pdf"},
  {id:5,name:"Ki·∫øm ƒê·∫°i",price:90000,img:"images/kiem-dai.jpg",pdf:"pdf/kiem-dai.pdf"},
  {id:6,name:"Logic Ng∆∞·ªùi Ngh√®o",price:100000,img:"images/logic-nguoi-ngheo.jpg",pdf:"pdf/logic-nguoi-ngheo.pdf"}
];

function loadCart(){ return JSON.parse(localStorage.getItem(CART_KEY)||"[]"); }
function saveCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); }
function updateCartCount(){
  const c = loadCart();
  document.getElementById("cartCount").innerText = c.reduce((t,i)=>t+i.qty,0);
}

function addToCart(id){
  const c=loadCart();
  const i=c.find(x=>x.id===id);
  if(i) i.qty++; else c.push({id,qty:1});
  saveCart(c);
  updateCartCount();
  alert("ƒê√£ th√™m v√†o gi·ªè!");
}

function openCart(){
  const cart=loadCart();
  let html="", total=0;
  cart.forEach(ci=>{
    const b=books.find(x=>x.id===ci.id);
    total += b.price*ci.qty;
    html += `<p>${b.name} x ${ci.qty} = ${(b.price*ci.qty).toLocaleString("vi-VN")}‚Ç´</p>`;
  });
  document.getElementById("cartItems").innerHTML = html || "<p>Gi·ªè h√†ng tr·ªëng</p>";
  document.getElementById("cartTotal").innerText = total.toLocaleString("vi-VN");
  document.getElementById("cartModal").style.display="block";
}

function closeCart(){
  document.getElementById("cartModal").style.display="none";
}

function checkout(e){
  e.preventDefault();

  const name  = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const phone = document.getElementById("phone").value || "Ch∆∞a cung c·∫•p";

  const cart = loadCart();
  let total = 0;

  const cartText = cart.map(ci=>{
    const b=books.find(x=>x.id===ci.id);
    total += b.price*ci.qty;
    return `${b.name} x ${ci.qty}`;
  }).join(", ");

  // G·ª≠i email qua EmailJS v·ªõi ID c·ªßa b·∫°n
  emailjs.send("Songking0006","Songking0006",{
    name: name,
    email: email,
    phone: phone,
    cart: cartText,
    total: total.toLocaleString("vi-VN") + "‚Ç´"
  });

  // QR Thanh to√°n
  const qr = `https://img.vietqr.io/image/vietcombank-1054523832-compact2.png?amount=${total}&addInfo=Thanh%20toan%20Ebook&accountName=VANG%20A%20SONG`;
  document.getElementById("qrImage").src = qr;
  document.getElementById("qrBox").style.display = "block";
  document.getElementById("checkoutForm").style.display = "none";
  document.getElementById("totalText").innerText = "T·ªïng thanh to√°n: " + total.toLocaleString("vi-VN") + "‚Ç´";

  setTimeout(() => {
    localStorage.removeItem(CART_KEY);
    updateCartCount();
  }, 3000);

  return false;
}

function openPreview(file){
  document.getElementById("previewFrame").src = file;
  document.getElementById("previewModal").style.display = "block";
}
function closePreview(){
  document.getElementById("previewFrame").src = "";
  document.getElementById("previewModal").style.display = "none";
}

document.getElementById("bookList").innerHTML =
  books.map(b=>`
<div class="book">
  <img src="${b.img}">
  <h4>${b.name}</h4>
  <p>${b.price===0?'0ƒë (S√°ch t·∫∑ng)':b.price.toLocaleString("vi-VN")+'‚Ç´'}</p>
  <a onclick="openPreview('${b.pdf}')">üìñ ƒê·ªçc th·ª≠</a>
  <button onclick="addToCart(${b.id})">Th√™m v√†o gi·ªè</button>
</div>`).join("");

updateCartCount();
</script>

</body>
</html>
